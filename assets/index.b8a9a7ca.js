import{a as e,s as n,r as t,g as o,y as a,k as i,o as l,c as s,b as c,F as d,z as r,A as u,B as m,_ as g,m as p,x as f,f as C,w as v,i as h,n as y,p as x,e as k}from"./index.e46b4b23.js";const N=e=>(x("data-v-2ef3315c"),e=e(),k(),e),w={class:"mapping-component"},I=["width","height"],_=p('<defs data-v-2ef3315c><marker id="markerArrow" class="path" markerWidth="12" markerHeight="12" refX="12" refY="6" orient="auto" data-v-2ef3315c><path d="M2,4 L9,6 L2,8 L2,4" class="arrow" fill="#0077FF" data-v-2ef3315c></path></marker><marker id="markerArrowSuccess" class="path" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" data-v-2ef3315c><path d="M2,4 L9,6 L2,8 L2,4" class="arrow success" fill="#0077FF" data-v-2ef3315c></path></marker><marker id="markerArrowError" class="path" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" data-v-2ef3315c><path d="M2,4 L9,6 L2,8 L2,4" class="arrow error" fill="#0077FF" data-v-2ef3315c></path></marker></defs>',1),T=["d"],b=["onClick"],L=["cx","cy"],M=["x","y"],F=["d"],E={class:"table-section source"},A=N((()=>c("div",null,[c("span",null,"源表字段"),c("span",null,"类型")],-1))),$={style:{padding:"5px 10px"}},H=["onMousedown"],R=N((()=>c("div",null,[c("span",{style:{"border-right":"0"}},[c("a",null,"+添加一行")])],-1))),W={class:"table-section target"},P=N((()=>c("div",null,[c("span",null,"目标表字段"),c("span",null,"类型")],-1))),V=["onMouseup"];var j=g(e({__name:"mapping",props:{sourceColumns:{default:()=>[]},targetColumns:{default:()=>[]}},emits:["data-changed"],setup(e,{expose:g,emit:p}){const x=e,k=n(),N=t({sourceColumns:[],targetColumns:[],connectColumns:[],svgWidth:0,svgHeight:0,isConnecting:!1,sourceConnectItem:null,targetConnectItem:null,connectingPath:"",popVisible:!1});function j(){N.svgWidth=k.value.offsetWidth,N.svgHeight=36*(Math.max(x.sourceColumns.length,x.targetColumns.length)+2)+2}function X(){j(),N.connectColumns.forEach((e=>{const n={x:360,y:36*(e.sourceIndex+1)+18},t={x:k.value.offsetWidth-360,y:36*(e.targetIndex+1)+18},o=`M${n.x},${n.y} L${t.x},${t.y}`,a={x:n.x+(t.x-n.x)/2,y:n.y+(t.y-n.y)/2};e.sourcePos=n,e.targetPos=t,e.path=o,e.close=a}))}function Y(){N.isConnecting=!1,N.sourceConnectItem.connecting=!1,setTimeout((()=>{N.connectingPath="",window.removeEventListener("mouseup",Y),window.removeEventListener("mousemove",z)}))}function z(e){const n=360,t=36*(N.sourceConnectItem.index+1)+18,o=e.clientX-k.value.getBoundingClientRect().left,a=e.clientY-k.value.getBoundingClientRect().top;N.connectingPath=`M${n},${t} L${o},${a}`}function B(e,n){if(!N.sourceConnectItem)return;const t={x:360,y:36*(N.sourceConnectItem.index+1)+18},o={x:k.value.offsetWidth-360,y:36*(e.index+1)+18},a=`M${t.x},${t.y} L${o.x},${o.y}`,i={x:t.x+(o.x-t.x)/2,y:t.y+(o.y-t.y)/2};N.sourceConnectItem.connected=!0,N.sourceConnectItem.targetFieldName=e.fieldName,e.connected=!0,e.disabled=!0,N.connectColumns.push({sourceId:N.sourceConnectItem.id,sourceIndex:N.sourceConnectItem.index,targetId:e.id,targetIndex:n,sourcePos:t,targetPos:o,path:a,close:i}),setTimeout((()=>{N.sourceConnectItem=null}))}function U(e){N.sourceColumns.forEach((n=>{n.id===e.sourceId&&(n.connected=!1,n.targetFieldName=null)})),N.targetColumns.forEach((n=>{n.id===e.targetId&&(n.connected=!1,n.disabled=!1)})),N.connectColumns=N.connectColumns.filter((n=>n!==e))}function S(){N.connectColumns=[],N.sourceColumns.forEach((e=>{e.connecting=!1,e.connected=!1})),N.targetColumns.forEach((e=>{e.connecting=!1,e.connected=!1}))}return o((()=>{setTimeout((()=>{j(),window.addEventListener("resize",X,!1)}))})),a((()=>{window.removeEventListener("resize",X,!1)})),N.sourceColumns=x.sourceColumns.map(((e,n)=>({...e,connecting:!1,connected:!1,index:n,targetFieldName:void 0}))),N.targetColumns=x.targetColumns.map(((e,n)=>({...e,connecting:!1,connected:!1,index:n,disabled:!1}))),g({lineMapping:function(){S();for(let e=0;e<N.sourceColumns.length;e++){const n=N.sourceColumns[e],t=N.targetColumns[e];t&&(N.sourceConnectItem=n,B(t,e))}},nameMapping:function(){S();for(let e=0;e<N.sourceColumns.length;e++){const n=N.sourceColumns[e];for(let e=0;e<N.targetColumns.length;e++){const t=N.targetColumns[e];t.fieldName===n.fieldName&&(N.sourceConnectItem=n,B(t,e))}}},emptyMapping:S}),(e,n)=>{const t=i("a-select-option"),o=i("a-select"),a=i("a-popover");return l(),s("div",w,[c("div",{ref_key:"mappingContentRef",ref:k,class:u(["mapping-content",{connecting:N.isConnecting}]),style:m({height:N.svgHeight+"px"})},[(l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",width:N.svgWidth,height:N.svgHeight,class:"link-section"},[_,c("g",null,[(l(!0),s(d,null,r(N.connectColumns,((e,n)=>(l(),s("g",{key:n,class:"link-g"},[c("path",{d:e.path,class:"link","marker-end":"url(#markerArrow)"},null,8,T),c("g",{class:"close",onClick:n=>U(e)},[c("circle",{cx:e.close.x,cy:e.close.y,r:"10",fill:"red"},null,8,L),c("text",{x:e.close.x-3,y:e.close.y+3,fill:"#fff"},"x",8,M)],8,b)])))),128)),c("g",null,[c("path",{d:N.connectingPath,class:"link","marker-end":"url(#markerArrow)"},null,8,F)])])],8,I)),c("div",E,[A,(l(!0),s(d,null,r(N.sourceColumns,((e,n)=>(l(),s("div",{key:n,class:"table-field"},[c("span",null,f(e.fieldName),1),c("span",null,f(e.fieldType),1),C(a,{onVisibleChange:n=>{return o=e,(t=n)&&(o.connecting=!0),void(t||o.connected||N.isConnecting||(o.connecting=!1));var t,o}},{content:v((()=>[c("div",$,[C(o,{value:e.targetFieldName,"onUpdate:value":n=>e.targetFieldName=n,"get-popup-container":e=>e.parentNode,style:{width:"150px"},placeholder:"请选择",onChange:n=>function(e){if(e.targetFieldName){const n=e.targetFieldName;N.connectColumns.forEach((n=>{n.sourceId===e.id&&U(n)})),e.targetFieldName=n,N.targetColumns.forEach(((n,t)=>{n.fieldName===e.targetFieldName&&(N.sourceConnectItem=e,B(n,t))}))}}(e)},{default:v((()=>[(l(!0),s(d,null,r(N.targetColumns,((e,n)=>(l(),h(t,{key:n,value:e.fieldName,disabled:e.disabled},{default:v((()=>[y(f(e.fieldName),1)])),_:2},1032,["value","disabled"])))),128))])),_:2},1032,["value","onUpdate:value","get-popup-container","onChange"])])])),default:v((()=>[c("i",{class:u(["connection",{connecting:e.connecting,connected:e.connected}]),onMousedown:n=>{return(t=e).connecting=!0,N.isConnecting=!0,N.sourceConnectItem=t,window.addEventListener("mouseup",Y,!1),void window.addEventListener("mousemove",z,!1);var t}},null,42,H)])),_:2},1032,["onVisibleChange"])])))),128)),R]),c("div",W,[P,(l(!0),s(d,null,r(N.targetColumns,((e,n)=>(l(),s("div",{key:n,class:"table-field",onMouseup:t=>B(e,n)},[c("span",null,f(e.fieldName),1),c("span",null,f(e.fieldType),1),c("i",{class:u(["connection",{connected:e.connected}])},null,2)],40,V)))),128))])],6)])}}}),[["__scopeId","data-v-2ef3315c"]]);const X={class:"mapping-container"},Y={style:{width:"70%",height:"100%",display:"inline-block"}};var z=g(e({__name:"index",setup(e){const o=n(),a=t({sourceColumns:[{fieldName:"id",fieldType:"INT",id:11},{fieldName:"tenant_id",fieldType:"INT",id:12},{fieldName:"job_id",fieldType:"VARCHAR",id:13},{fieldName:"job_key",fieldType:"VARCHAR",id:14},{fieldName:"job_name",fieldType:"VARCHAR",id:15},{fieldName:"task_id",fieldType:"INT",id:16},{fieldName:"line_id",fieldType:"INT",id:17},{fieldName:"system_id",fieldType:"INT",id:18}],targetColumns:[{fieldName:"line_id",fieldType:"string",id:21},{fieldName:"system_id",fieldType:"string",id:22},{fieldName:"station_id",fieldType:"string",id:23},{fieldName:"device_type",fieldType:"string",id:24},{fieldName:"device_id",fieldType:"string",id:25},{fieldName:"point_type",fieldType:"string",id:26}]});function i(){o.value.lineMapping()}function d(){o.value.nameMapping()}function r(){o.value.emptyMapping()}return(e,n)=>(l(),s("div",X,[c("div",Y,[C(j,{ref_key:"mappingRef",ref:o,"source-columns":a.sourceColumns,"target-columns":a.targetColumns},null,8,["source-columns","target-columns"])]),c("div",{style:{display:"inline-block","vertical-align":"top"}},[c("div",{style:{padding:"5px 10px"}},[c("a",{onClick:i},"同行映射")]),c("div",{style:{padding:"5px 10px"}},[c("a",{onClick:d},"同名映射")]),c("div",{style:{padding:"5px 10px"}},[c("a",{onClick:r},"清空映射")])])]))}}),[["__scopeId","data-v-369a565a"]]);export{z as default};
